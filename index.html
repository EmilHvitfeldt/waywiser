<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content='Predictive models of spatial data may have spatially
    structured errors, with "hot spots" of higher than expected error
    clustered geographically due to spatial structure in the underlying
    data. These functions provide methods for measuring the spatial
    structure of model errors for models, and are particularly useful for
    models fit using the tidymodels framework.'>
<title>Yardstick Extensions for Measuring Spatial Structure in Model
    Residuals • waywiser</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><link href="deps/_Noto%20Sans-0.4.1/font.css" rel="stylesheet">
<link href="deps/_Patua%20One-0.4.1/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Yardstick Extensions for Measuring Spatial Structure in Model
    Residuals">
<meta property="og:description" content='Predictive models of spatial data may have spatially
    structured errors, with "hot spots" of higher than expected error
    clustered geographically due to spatial structure in the underlying
    data. These functions provide methods for measuring the spatial
    structure of model errors for models, and are particularly useful for
    models fit using the tidymodels framework.'>
<meta property="og:image" content="https://mikemahoney218.github.io/waywiser/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">waywiser</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/mikemahoney218/waywiser/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="waywiser-">waywiser 
<a class="anchor" aria-label="anchor" href="#waywiser-"></a>
</h1>
</div>
<!-- badges: start -->
<p>“Waywiser” is an old-timey name for a <a href="https://en.wikipedia.org/wiki/Surveyor%27s_wheel" class="external-link">surveyor’s wheel</a>, a device that makes measuring long distances easier than with measurement tools like a ruler or yardstick. The waywiser R package makes measuring model performance on spatial data easier, extending the <a href="https://yardstick.tidymodels.org/" class="external-link">yardstick</a> R package to incorporate measures of spatial autocorrelation provided by <a href="https://cran.r-project.org/package=spdep" class="external-link">spdep</a>.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install waywiser from CRAN via:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"waywiser"</span><span class="op">)</span></span></code></pre></div>
<p>You can install the development version of waywiser from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"mikemahoney218/waywiser"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>Let’s walk through how we can use waywiser to find local indicators of spatial autocorrelation for a very simple model. First things first, let’s load a few libraries:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># waywiser itself, of course:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mikemahoney218/waywiser" class="external-link">waywiser</a></span><span class="op">)</span></span>
<span><span class="co"># For the %&gt;% pipe and mutate:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<p>We’ll be working with the <code>guerry</code> data from the sfdep package, fitting a linear model to associate crimes against persons with literacy. Let’s load the data now:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">guerry</span>, package <span class="op">=</span> <span class="st">"sfdep"</span><span class="op">)</span></span></code></pre></div>
<p>We’ll fit a simple linear model relating crimes against persons with literacy, and then generate predictions from that model. We can use <code><a href="reference/local_moran_i.html">ww_local_moran_i()</a></code> to calculate the local spatial autocorrelation of our residuals at each data point:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">guerry</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">crime_pers</span> <span class="op">~</span> <span class="va">literacy</span>, <span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="reference/local_moran_i.html">ww_local_moran_i</a></span><span class="op">(</span><span class="va">crime_pers</span>, <span class="va">pred</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 85 × 4</span></span>
<span><span class="co">#&gt;    .metric       .estimator .estimate                                   geometry</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;         &lt;chr&gt;          &lt;dbl&gt;                             &lt;MULTIPOLYGON&gt;</span></span>
<span><span class="co">#&gt;  1 local_moran_i standard      0.530  (((381847 1762775, 381116 1763059, 379972…</span></span>
<span><span class="co">#&gt;  2 local_moran_i standard      0.858  (((381847 1762775, 381116 1763059, 379972…</span></span>
<span><span class="co">#&gt;  3 local_moran_i standard      0.759  (((381847 1762775, 381116 1763059, 379972…</span></span>
<span><span class="co">#&gt;  4 local_moran_i standard      0.732  (((381847 1762775, 381116 1763059, 379972…</span></span>
<span><span class="co">#&gt;  5 local_moran_i standard      0.207  (((381847 1762775, 381116 1763059, 379972…</span></span>
<span><span class="co">#&gt;  6 local_moran_i standard      0.860  (((381847 1762775, 381116 1763059, 379972…</span></span>
<span><span class="co">#&gt;  7 local_moran_i standard      0.692  (((381847 1762775, 381116 1763059, 379972…</span></span>
<span><span class="co">#&gt;  8 local_moran_i standard      1.69   (((381847 1762775, 381116 1763059, 379972…</span></span>
<span><span class="co">#&gt;  9 local_moran_i standard     -0.0109 (((381847 1762775, 381116 1763059, 379972…</span></span>
<span><span class="co">#&gt; 10 local_moran_i standard      0.710  (((381847 1762775, 381116 1763059, 379972…</span></span>
<span><span class="co">#&gt; # … with 75 more rows</span></span></code></pre></div>
<p>If you’re familiar with spdep, you can probably guess that waywiser is doing <em>something</em> under the hood here to calculate which of our observations are neighbors, and how to create spatial weights from those neighborhoods. And that guess would be right – waywiser is making use of two functions, <code><a href="reference/ww_build_neighbors.html">ww_build_neighbors()</a></code> and <code><a href="reference/ww_build_weights.html">ww_build_weights()</a></code>, in order to automatically calculate spatial weights for calculating metrics:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/ww_build_neighbors.html">ww_build_neighbors</a></span><span class="op">(</span><span class="va">guerry</span><span class="op">)</span></span>
<span><span class="co">#&gt; Neighbour list object:</span></span>
<span><span class="co">#&gt; Number of regions: 85 </span></span>
<span><span class="co">#&gt; Number of nonzero links: 420 </span></span>
<span><span class="co">#&gt; Percentage nonzero weights: 5.813149 </span></span>
<span><span class="co">#&gt; Average number of links: 4.941176</span></span>
<span></span>
<span><span class="fu"><a href="reference/ww_build_weights.html">ww_build_weights</a></span><span class="op">(</span><span class="va">guerry</span><span class="op">)</span></span>
<span><span class="co">#&gt; Characteristics of weights list object:</span></span>
<span><span class="co">#&gt; Neighbour list object:</span></span>
<span><span class="co">#&gt; Number of regions: 85 </span></span>
<span><span class="co">#&gt; Number of nonzero links: 420 </span></span>
<span><span class="co">#&gt; Percentage nonzero weights: 5.813149 </span></span>
<span><span class="co">#&gt; Average number of links: 4.941176 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Weights style: W </span></span>
<span><span class="co">#&gt; Weights constants summary:</span></span>
<span><span class="co">#&gt;    n   nn S0      S1       S2</span></span>
<span><span class="co">#&gt; W 85 7225 85 37.2761 347.6683</span></span></code></pre></div>
<p>These functions aren’t always the best way to calculate spatial weights for your data, however. As a result, waywiser also lets you specify your own weights directly:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="va">guerry</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">spdep</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/dnearneigh.html" class="external-link">dnearneigh</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">97000</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">spdep</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html" class="external-link">nb2listw</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">weights</span></span>
<span><span class="co">#&gt; Characteristics of weights list object:</span></span>
<span><span class="co">#&gt; Neighbour list object:</span></span>
<span><span class="co">#&gt; Number of regions: 85 </span></span>
<span><span class="co">#&gt; Number of nonzero links: 314 </span></span>
<span><span class="co">#&gt; Percentage nonzero weights: 4.346021 </span></span>
<span><span class="co">#&gt; Average number of links: 3.694118 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Weights style: W </span></span>
<span><span class="co">#&gt; Weights constants summary:</span></span>
<span><span class="co">#&gt;    n   nn S0       S1       S2</span></span>
<span><span class="co">#&gt; W 85 7225 85 51.86738 348.7071</span></span>
<span></span>
<span><span class="va">guerry</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">crime_pers</span> <span class="op">~</span> <span class="va">literacy</span>, <span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="reference/local_moran_i.html">ww_local_moran_i</a></span><span class="op">(</span><span class="va">crime_pers</span>, <span class="va">pred</span>, <span class="va">weights</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 85 × 4</span></span>
<span><span class="co">#&gt;    .metric       .estimator .estimate                                   geometry</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;         &lt;chr&gt;          &lt;dbl&gt;                             &lt;MULTIPOLYGON&gt;</span></span>
<span><span class="co">#&gt;  1 local_moran_i standard    0.530    (((381847 1762775, 381116 1763059, 379972…</span></span>
<span><span class="co">#&gt;  2 local_moran_i standard    0.794    (((381847 1762775, 381116 1763059, 379972…</span></span>
<span><span class="co">#&gt;  3 local_moran_i standard    0.646    (((381847 1762775, 381116 1763059, 379972…</span></span>
<span><span class="co">#&gt;  4 local_moran_i standard    0.687    (((381847 1762775, 381116 1763059, 379972…</span></span>
<span><span class="co">#&gt;  5 local_moran_i standard    0.207    (((381847 1762775, 381116 1763059, 379972…</span></span>
<span><span class="co">#&gt;  6 local_moran_i standard    1.49     (((381847 1762775, 381116 1763059, 379972…</span></span>
<span><span class="co">#&gt;  7 local_moran_i standard    0.692    (((381847 1762775, 381116 1763059, 379972…</span></span>
<span><span class="co">#&gt;  8 local_moran_i standard    1.69     (((381847 1762775, 381116 1763059, 379972…</span></span>
<span><span class="co">#&gt;  9 local_moran_i standard   -0.000610 (((381847 1762775, 381116 1763059, 379972…</span></span>
<span><span class="co">#&gt; 10 local_moran_i standard    0.859    (((381847 1762775, 381116 1763059, 379972…</span></span>
<span><span class="co">#&gt; # … with 75 more rows</span></span></code></pre></div>
<p>Or as a function, which lets you use custom weights with other tidymodels functions like <code>fit_resamples()</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weights_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">spdep</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/dnearneigh.html" class="external-link">dnearneigh</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">97000</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">spdep</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html" class="external-link">nb2listw</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span> </span>
<span></span>
<span><span class="va">guerry</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">crime_pers</span> <span class="op">~</span> <span class="va">literacy</span>, <span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="reference/local_moran_i.html">ww_local_moran_i</a></span><span class="op">(</span><span class="va">crime_pers</span>, <span class="va">pred</span>, <span class="va">weights_function</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 85 × 4</span></span>
<span><span class="co">#&gt;    .metric       .estimator .estimate                                   geometry</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;         &lt;chr&gt;          &lt;dbl&gt;                             &lt;MULTIPOLYGON&gt;</span></span>
<span><span class="co">#&gt;  1 local_moran_i standard    0.530    (((381847 1762775, 381116 1763059, 379972…</span></span>
<span><span class="co">#&gt;  2 local_moran_i standard    0.794    (((381847 1762775, 381116 1763059, 379972…</span></span>
<span><span class="co">#&gt;  3 local_moran_i standard    0.646    (((381847 1762775, 381116 1763059, 379972…</span></span>
<span><span class="co">#&gt;  4 local_moran_i standard    0.687    (((381847 1762775, 381116 1763059, 379972…</span></span>
<span><span class="co">#&gt;  5 local_moran_i standard    0.207    (((381847 1762775, 381116 1763059, 379972…</span></span>
<span><span class="co">#&gt;  6 local_moran_i standard    1.49     (((381847 1762775, 381116 1763059, 379972…</span></span>
<span><span class="co">#&gt;  7 local_moran_i standard    0.692    (((381847 1762775, 381116 1763059, 379972…</span></span>
<span><span class="co">#&gt;  8 local_moran_i standard    1.69     (((381847 1762775, 381116 1763059, 379972…</span></span>
<span><span class="co">#&gt;  9 local_moran_i standard   -0.000610 (((381847 1762775, 381116 1763059, 379972…</span></span>
<span><span class="co">#&gt; 10 local_moran_i standard    0.859    (((381847 1762775, 381116 1763059, 379972…</span></span>
<span><span class="co">#&gt; # … with 75 more rows</span></span></code></pre></div>
<p>Providing custom weights also lets us use <code>ww_local_moran_i_vec</code> to add a column to our original data frame with our statistic, which makes plotting using our original geometries easier:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ww_build_weights.html">ww_build_weights</a></span><span class="op">(</span><span class="va">guerry</span><span class="op">)</span></span>
<span></span>
<span><span class="va">guerry</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">crime_pers</span> <span class="op">~</span> <span class="va">literacy</span>, <span class="va">.</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         .estimate <span class="op">=</span> <span class="fu"><a href="reference/local_moran_i.html">ww_local_moran_i_vec</a></span><span class="op">(</span><span class="va">crime_pers</span>, <span class="va">pred</span>, <span class="va">weights</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">.estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient2</a></span><span class="op">(</span></span>
<span>    <span class="st">"Moran's I"</span>, </span>
<span>    low <span class="op">=</span> <span class="st">"#018571"</span>, </span>
<span>    mid <span class="op">=</span> <span class="st">"white"</span>, </span>
<span>    high <span class="op">=</span> <span class="st">"#A6611A"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-2022_06_29-guerry-1.png" title="A map of calculated Moran's I values for the Guerry data set." alt="A map of calculated Moran's I values for the Guerry data set." width="100%"></p>
<p>This makes it easy to see what areas are poorly represented by our model, which might lead us to identify ways to improve our model or help us identify caveats and limitations of the models we’re working with.</p>
</div>
<div class="section level2">
<h2 id="contributing">Contributing<a class="anchor" aria-label="anchor" href="#contributing"></a>
</h2>
<p>This project is released with a <a href="https://contributor-covenant.org/version/2/1/CODE_OF_CONDUCT.html" class="external-link">Contributor Code of Conduct</a>. By contributing to this project, you agree to abide by its terms.</p>
<ul>
<li><p>If you think you have encountered a bug, please <a href="https://github.com/mikemahoney218/waywiser" class="external-link">submit an issue</a>.</p></li>
<li><p>Please include a <a href="https://reprex.tidyverse.org/articles/articles/learn-reprex.html" class="external-link">reprex</a> (a minimal, reproducible example) to clearly communicate about your code.</p></li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/mikemahoney218/waywiser/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/mikemahoney218/waywiser/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
<li><a href="SUPPORT.html">Getting help</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing waywiser</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://www.mm218.dev/" class="external-link">Michael Mahoney</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-2402-304X" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>
<a href="https://www.rstudio.com" class="external-link"><img src="https://www.tidyverse.org/rstudio-logo.svg" alt="RStudio" width="72"></a> <br><small class="roles"> Copyright holder, funder </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://www.mm218.dev/" class="external-link">Michael Mahoney</a>, <a href="https://www.rstudio.com" class="external-link"><img src="https://www.tidyverse.org/rstudio-logo.svg" alt="RStudio" width="72"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
