<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content='Predictive models of spatial data may have spatially
    structured errors, with "hot spots" of higher than expected error
    clustered geographically due to spatial structure in the underlying
    data. These functions provide methods for measuring the spatial
    structure of model errors for models, and are particularly useful for
    models fit using the tidymodels framework.'>
<title>Yardstick Extensions for Measuring Spatial Structure in Model
    Residuals • waywiser</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><link href="deps/_Source%20Sans%20Pro-0.4.1/font.css" rel="stylesheet">
<link href="deps/_Source%20Code%20Pro-0.4.1/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Yardstick Extensions for Measuring Spatial Structure in Model
    Residuals">
<meta property="og:description" content='Predictive models of spatial data may have spatially
    structured errors, with "hot spots" of higher than expected error
    clustered geographically due to spatial structure in the underlying
    data. These functions provide methods for measuring the spatial
    structure of model errors for models, and are particularly useful for
    models fit using the tidymodels framework.'>
<meta property="og:image" content="https://mikemahoney218.github.io/waywiser/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-none"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">waywiser</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/mikemahoney218/waywiser/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="waywiser-">waywiser 
<a class="anchor" aria-label="anchor" href="#waywiser-"></a>
</h1>
</div>
<!-- badges: start -->
<p>“Waywiser” is an old-timey name for a <a href="https://en.wikipedia.org/wiki/Surveyor%27s_wheel" class="external-link">surveyor’s wheel</a>, a device that makes measuring long distances easier than with measurement tools like a ruler or yardstick. The waywiser R package makes measuring model performance on spatial data easier, extending the <a href="https://yardstick.tidymodels.org/" class="external-link">yardstick</a> R package to incorporate measures of spatial autocorrelation provided by <a href="https://sfdep.josiahparry.com/" class="external-link">sfdep</a>.</p>
<p>Please note that this package is highly experimental. The user-facing API is likely to change without deprecation warnings up until the first CRAN release.</p>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>waywiser doesn’t quite work with <code>fit_resamples()</code> yet, so this example is more complex than it needs to be.</p>
<p>That said, let’s walk through how we can use waywiser to find local indicators of spatial autocorrelation for a very simple model, looking at how tree canopy coverage impacts temperature in Boston, Massachusetts.</p>
<p>We’re going to use a bunch of packages for this process:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># waywiser itself, of course:</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mikemahoney218/waywiser" class="external-link">waywiser</a></span><span class="op">)</span>

<span class="co"># For spatial cross-validation and our data set:</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/spatialsample" class="external-link">spatialsample</a></span><span class="op">)</span>

<span class="co"># For model fitting:</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org" class="external-link">tidymodels</a></span><span class="op">)</span>
<span class="co">#&gt; ── Attaching packages ───────────────────────────────── tidymodels 0.2.0.9000 ──</span>
<span class="co">#&gt; ✔ broom        0.8.0          ✔ rsample      1.0.0.9000</span>
<span class="co">#&gt; ✔ dials        1.0.0          ✔ tibble       3.1.7     </span>
<span class="co">#&gt; ✔ dplyr        1.0.9          ✔ tidyr        1.2.0     </span>
<span class="co">#&gt; ✔ infer        1.0.2          ✔ tune         0.2.0.9002</span>
<span class="co">#&gt; ✔ modeldata    0.1.1          ✔ workflows    0.2.6.9001</span>
<span class="co">#&gt; ✔ parsnip      0.2.1.9003     ✔ workflowsets 0.2.1     </span>
<span class="co">#&gt; ✔ purrr        0.3.4          ✔ yardstick    1.0.0.9000</span>
<span class="co">#&gt; ✔ recipes      0.2.0</span>
<span class="co">#&gt; ── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──</span>
<span class="co">#&gt; ✖ purrr::discard() masks scales::discard()</span>
<span class="co">#&gt; ✖ dplyr::filter()  masks stats::filter()</span>
<span class="co">#&gt; ✖ dplyr::lag()     masks stats::lag()</span>
<span class="co">#&gt; ✖ recipes::step()  masks stats::step()</span>
<span class="co">#&gt; • Learn how to get started at https://www.tidymodels.org/start/</span>

<span class="co"># General data-wrangling:</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span>
<span class="co">#&gt; Linking to GEOS 3.10.2, GDAL 3.4.3, PROJ 8.2.0; sf_use_s2() is TRUE</span>

<span class="co"># Visualization:</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></code></pre></div>
<p>We’ll be working with the <code>boston_canopy</code> data from the spatialsample package, fitting a linear model to associate tree canopy coverage with mean temperature. We’ll turn on sf’s ability to download coordinate reference systems over the internet, and then cut the data into five different cross-validation folds based on spatial proximity:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://r-spatial.github.io/sf/reference/proj_tools.html" class="external-link">sf_proj_network</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; [1] "https://cdn.proj.org"</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf_project.html" class="external-link">sf_add_proj_units</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span>
<span class="va">folds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://spatialsample.tidymodels.org/reference/spatial_clustering_cv.html" class="external-link">spatial_clustering_cv</a></span><span class="op">(</span><span class="va">boston_canopy</span>, v <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<p>Our next step is to actually fit a model to these resamples! We’re going to use an extremely simple linear regression, fit using tools from the tidymodels packages <a href="https://workflows.tidymodels.org/" class="external-link">workflows</a> and <a href="https://parsnip.tidymodels.org/" class="external-link">parsnip</a>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_fit</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">add_model</span><span class="op">(</span><span class="fu">linear_reg</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">add_formula</span><span class="op">(</span><span class="va">mean_temp</span> <span class="op">~</span> <span class="va">canopy_area_2019</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">fit_resamples</span><span class="op">(</span><span class="va">folds</span>, control <span class="op">=</span> <span class="fu">control_resamples</span><span class="op">(</span>save_pred <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>

<span class="va">model_fit</span>
<span class="co">#&gt; # Resampling results</span>
<span class="co">#&gt; # 5-fold spatial cross-validation </span>
<span class="co">#&gt; # A tibble: 5 × 5</span>
<span class="co">#&gt;   splits            id    .metrics         .notes           .predictions      </span>
<span class="co">#&gt;   &lt;list&gt;            &lt;chr&gt; &lt;list&gt;           &lt;list&gt;           &lt;list&gt;            </span>
<span class="co">#&gt; 1 &lt;split [600/82]&gt;  Fold1 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [82 × 4]&gt; </span>
<span class="co">#&gt; 2 &lt;split [589/93]&gt;  Fold2 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [93 × 4]&gt; </span>
<span class="co">#&gt; 3 &lt;split [524/158]&gt; Fold3 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [158 × 4]&gt;</span>
<span class="co">#&gt; 4 &lt;split [497/185]&gt; Fold4 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [185 × 4]&gt;</span>
<span class="co">#&gt; 5 &lt;split [518/164]&gt; Fold5 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [164 × 4]&gt;</span></code></pre></div>
<p>As we can see, our data contains a lot of nested tibbles. We only care about our actual assessment-set predictions and the corresponding true values, however. We can get rid of all the other columns and unpack the nested columns using some tools from dplyr and tidyr:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_predictions</span> <span class="op">&lt;-</span> <span class="va">model_fit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">transmute</a></span><span class="op">(</span>assessment <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">splits</span>, <span class="va">assessment</span><span class="op">)</span>,
            predictions <span class="op">=</span> <span class="va">.predictions</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">assessment</span>, <span class="va">predictions</span><span class="op">)</span>, names_repair <span class="op">=</span> <span class="st">"minimal"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="co"># "mean_temp" exists in both tables, so we'll get rid of the second one here:</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fl">22</span><span class="op">)</span>

<span class="va">model_predictions</span>
<span class="co">#&gt; # A tibble: 682 × 22</span>
<span class="co">#&gt;    grid_id land_area canopy_gain canopy_loss canopy_no_change canopy_area_2014</span>
<span class="co">#&gt;    &lt;chr&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span>
<span class="co">#&gt;  1 H-10     2691490.      73098.      80362.          345823.          426185.</span>
<span class="co">#&gt;  2 M-9      2690727.      52443.      53467.          304239.          357706.</span>
<span class="co">#&gt;  3 I-10     2691491.      77370.     129464.          434683.          564147.</span>
<span class="co">#&gt;  4 G-15      298658.      10742.      10502.          118964.          129466.</span>
<span class="co">#&gt;  5 H-13     2691492.      90971.     103740.          717828.          821569.</span>
<span class="co">#&gt;  6 G-12     2690726.     109754.      89181.          957357.         1046538.</span>
<span class="co">#&gt;  7 Q-10      156688.       9237.       3094.           57327.           60421.</span>
<span class="co">#&gt;  8 D-10      340049.      17981.       5737.          100755.          106492.</span>
<span class="co">#&gt;  9 M-10     2578879.      27026.      41240.          161115.          202355.</span>
<span class="co">#&gt; 10 J-9      2690726.      66740.      34839.          242211.          277050.</span>
<span class="co">#&gt; # … with 672 more rows, and 16 more variables: canopy_area_2019 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   change_canopy_area &lt;dbl&gt;, change_canopy_percentage &lt;dbl&gt;,</span>
<span class="co">#&gt; #   canopy_percentage_2014 &lt;dbl&gt;, canopy_percentage_2019 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   change_canopy_absolute &lt;dbl&gt;, mean_temp_morning &lt;dbl&gt;,</span>
<span class="co">#&gt; #   mean_temp_evening &lt;dbl&gt;, mean_temp &lt;dbl&gt;, mean_heat_index_morning &lt;dbl&gt;,</span>
<span class="co">#&gt; #   mean_heat_index_evening &lt;dbl&gt;, mean_heat_index &lt;dbl&gt;,</span>
<span class="co">#&gt; #   geometry &lt;MULTIPOLYGON [US_survey_foot]&gt;, .pred &lt;dbl&gt;, .row &lt;int&gt;, …</span></code></pre></div>
<p>Alright, one last bit of set-up.</p>
<p>waywiser builds on top of the <a href="https://sfdep.josiahparry.com/" class="external-link">sfdep</a> package, itself an extension for the <a href="https://r-spatial.github.io/spdep/index.html" class="external-link">spdep</a> spatial dependence library. These packages expect you to have objects representing the neighbors of your data set and the spatial weights between observations.</p>
<p>As a result, right now waywiser also expects you to already have those objects pre-created and to pass them as arguments to model metric functions. We’ll find the neighbors in our data using the <code>st_contiguity</code> function, and then calculate spatial weights via <code>st_weights</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://sfdep.josiahparry.com/reference/st_contiguity.html" class="external-link">st_contiguity</a></span><span class="op">(</span><span class="va">boston_canopy</span><span class="op">)</span>
<span class="va">wt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://sfdep.josiahparry.com/reference/st_weights.html" class="external-link">st_weights</a></span><span class="op">(</span><span class="va">nb</span><span class="op">)</span></code></pre></div>
<p>We’re finally ready to actually use functions from waywiser to assess our model! Let’s take a look at the local Moran’s I for each of our hexagons, identifying local clusters and outliers to indicate areas where our model might not be properly accounting for the spatial structure of our data.</p>
<p>We can use the <code><a href="reference/local_moran_i.html">ww_local_moran_i()</a></code> function to calculate the statistic for each observation in our data:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/local_moran_i.html">ww_local_moran_i</a></span><span class="op">(</span>
  <span class="va">model_predictions</span>,
  <span class="va">mean_temp</span>,
  <span class="va">.pred</span>,
  <span class="va">nb</span>,
  <span class="va">wt</span>
<span class="op">)</span>
<span class="co">#&gt; # A tibble: 682 × 3</span>
<span class="co">#&gt;    .metric       .estimator .estimate</span>
<span class="co">#&gt;    &lt;chr&gt;         &lt;chr&gt;          &lt;dbl&gt;</span>
<span class="co">#&gt;  1 local_moran_i standard     0.0655 </span>
<span class="co">#&gt;  2 local_moran_i standard     0.155  </span>
<span class="co">#&gt;  3 local_moran_i standard    -1.24   </span>
<span class="co">#&gt;  4 local_moran_i standard     0.0869 </span>
<span class="co">#&gt;  5 local_moran_i standard     0.0147 </span>
<span class="co">#&gt;  6 local_moran_i standard     0.00799</span>
<span class="co">#&gt;  7 local_moran_i standard     0.0967 </span>
<span class="co">#&gt;  8 local_moran_i standard     0.0596 </span>
<span class="co">#&gt;  9 local_moran_i standard     0.136  </span>
<span class="co">#&gt; 10 local_moran_i standard     0.0969 </span>
<span class="co">#&gt; # … with 672 more rows</span></code></pre></div>
<p>Or, if we want to add Moran’s I as a column to our data frame, we can use <code><a href="reference/local_moran_i.html">ww_local_moran_i_vec()</a></code> inside a call to <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_predictions</span> <span class="op">&lt;-</span> <span class="va">model_predictions</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>local_moran_i <span class="op">=</span> <span class="fu"><a href="reference/local_moran_i.html">ww_local_moran_i_vec</a></span><span class="op">(</span><span class="va">mean_temp</span>, <span class="va">.pred</span>, <span class="va">nb</span>, <span class="va">wt</span><span class="op">)</span><span class="op">)</span>

<span class="va">model_predictions</span>
<span class="co">#&gt; # A tibble: 682 × 23</span>
<span class="co">#&gt;    grid_id land_area canopy_gain canopy_loss canopy_no_change canopy_area_2014</span>
<span class="co">#&gt;    &lt;chr&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span>
<span class="co">#&gt;  1 H-10     2691490.      73098.      80362.          345823.          426185.</span>
<span class="co">#&gt;  2 M-9      2690727.      52443.      53467.          304239.          357706.</span>
<span class="co">#&gt;  3 I-10     2691491.      77370.     129464.          434683.          564147.</span>
<span class="co">#&gt;  4 G-15      298658.      10742.      10502.          118964.          129466.</span>
<span class="co">#&gt;  5 H-13     2691492.      90971.     103740.          717828.          821569.</span>
<span class="co">#&gt;  6 G-12     2690726.     109754.      89181.          957357.         1046538.</span>
<span class="co">#&gt;  7 Q-10      156688.       9237.       3094.           57327.           60421.</span>
<span class="co">#&gt;  8 D-10      340049.      17981.       5737.          100755.          106492.</span>
<span class="co">#&gt;  9 M-10     2578879.      27026.      41240.          161115.          202355.</span>
<span class="co">#&gt; 10 J-9      2690726.      66740.      34839.          242211.          277050.</span>
<span class="co">#&gt; # … with 672 more rows, and 17 more variables: canopy_area_2019 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   change_canopy_area &lt;dbl&gt;, change_canopy_percentage &lt;dbl&gt;,</span>
<span class="co">#&gt; #   canopy_percentage_2014 &lt;dbl&gt;, canopy_percentage_2019 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   change_canopy_absolute &lt;dbl&gt;, mean_temp_morning &lt;dbl&gt;,</span>
<span class="co">#&gt; #   mean_temp_evening &lt;dbl&gt;, mean_temp &lt;dbl&gt;, mean_heat_index_morning &lt;dbl&gt;,</span>
<span class="co">#&gt; #   mean_heat_index_evening &lt;dbl&gt;, mean_heat_index &lt;dbl&gt;,</span>
<span class="co">#&gt; #   geometry &lt;MULTIPOLYGON [US_survey_foot]&gt;, .pred &lt;dbl&gt;, .row &lt;int&gt;, …</span></code></pre></div>
<p>This makes it easier to visualize the outputs from these functions. For instance, we can use <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf()</a></code> in ggplot2 to see where our residuals are more clustered than expected:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_predictions</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    cut_points <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span>
      <span class="va">local_moran_i</span> <span class="op">&lt;=</span> <span class="op">-</span><span class="fl">1</span> <span class="op">~</span> <span class="st">"(-Inf, -1]"</span>,
      <span class="va">local_moran_i</span> <span class="op">&lt;=</span> <span class="op">-</span><span class="fl">0.5</span> <span class="op">~</span> <span class="st">"(-1, -0.5]"</span>,
      <span class="va">local_moran_i</span> <span class="op">&lt;=</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"(-0.5, 0]"</span>,
      <span class="va">local_moran_i</span> <span class="op">&lt;=</span> <span class="fl">0.5</span> <span class="op">~</span> <span class="st">"(0, 0.5]"</span>,
      <span class="va">local_moran_i</span> <span class="op">&lt;=</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"(0.5, 1]"</span>,
      <span class="va">local_moran_i</span> <span class="op">&gt;</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"(1, Inf)"</span>,
    <span class="op">)</span>,
    cut_points <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span>
      <span class="va">cut_points</span>,
      <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span>
        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>
          <span class="st">"(-Inf, -1]"</span>, 
          <span class="st">"(-1, -0.5]"</span>, 
          <span class="st">"(-0.5, 0]"</span>, 
          <span class="st">"(0, 0.5]"</span>, 
          <span class="st">"(0.5, 1]"</span>, 
          <span class="st">"(1, Inf)"</span><span class="op">)</span>
      <span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">cut_points</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"BrBG"</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-9-1.png" width="100%"></p>
<p>This makes it easy to see what areas are poorly represented by our model, which might lead us to identify ways to improve our model or help us identify caveats and limitations of the models we’re working with.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of waywiser from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("devtools")</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"mikemahoney218/waywiser"</span><span class="op">)</span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/mikemahoney218/waywiser/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/mikemahoney218/waywiser/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
<li><a href="SUPPORT.html">Getting help</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing waywiser</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://www.mm218.dev/" class="external-link">Michael Mahoney</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-2402-304X" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>
<a href="https://www.rstudio.com" class="external-link"><img src="https://www.tidyverse.org/rstudio-logo.svg" alt="RStudio" width="72"></a> <br><small class="roles"> Copyright holder, funder </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/mikemahoney218/waywiser/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/mikemahoney218/waywiser/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
</ul>
</div>

  </aside>
</div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://www.mm218.dev/" class="external-link">Michael Mahoney</a>, <a href="https://www.rstudio.com" class="external-link"><img src="https://www.tidyverse.org/rstudio-logo.svg" alt="RStudio" width="72"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

  </div></footer>
</body>
</html>
